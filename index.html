<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ñ‡∏±‡∏á‡∏î‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏¥‡∏á</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

  <div id="output">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

  <script>
  // =================================
  // STEP 2.2.1 ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤ id ‡∏à‡∏≤‡∏Å URL
  // =================================
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  const output = document.getElementById("output");

  if (!id) {
    output.textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö id";
    throw new Error("missing id");
  }

  // =================================
  // STEP 2.2.2 ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL ‡∏Ç‡∏≠‡∏á Apps Script
  // =================================
  // üëâ ‡πÅ‡∏Å‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ URL ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
  const API_URL =
    "https://script.google.com/macros/s/AKfycbx1HTDbrENZzzn0CAslzK7cIVmyF7qww9LB7slYFaSHnGi0GYztpg4gmP3sAT7aFbQP/exec" + "?id=" + id;

  // =================================
  // STEP 2.2.3 ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API
  // =================================
  fetch(API_URL)
    .then(res => res.json()) // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô JSON
    .then(data => {

      // ‡∏ñ‡πâ‡∏≤ API ‡∏ï‡∏≠‡∏ö error ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
      if (data.error) {
        output.textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        return;
      }

      // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
      let text = "";
      for (const key in data) {
        text += key + " : " + data[key] + "\n";
      }

      output.textContent = text;
    })
    .catch(err => {
      output.textContent = "‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
      console.error(err);
    });
</script>


</body>
</html>
